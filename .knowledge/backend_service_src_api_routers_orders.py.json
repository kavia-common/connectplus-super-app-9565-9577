{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints related to 'orders' in a backend service using FastAPI. It includes functions for creating orders, listing user orders, retrieving specific orders, and updating order status. The file also contains internal utility functions for engineer assignment based on area.", "external_files": ["src.core.auth", "src.core.db", "src.core.utils", "src.models.orders"], "external_methods": ["get_current_user", "require_roles", "get_db", "now_utc", "oid", "serialize_doc"], "published": ["create_order", "list_orders_for_user", "get_order_by_id", "update_order_status"], "classes": [], "methods": [{"name": "Optional[dict] _pick_engineer_for_area(db: Database, pincode: str)", "description": "Internal utility to select the engineer with the lowest workload active in a specific area, based on pincode.", "scope": "", "scopeKind": ""}, {"name": "create_order( body: OrderCreateIn, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )", "description": "Handles POST requests to create a new order, including assignment of an engineer if available, and returning the created order details.", "scope": "", "scopeKind": ""}, {"name": "list_orders_for_user( user: AuthUser = Depends(get_current_user), limit: int = Query(20, ge=1, le=100), db: Database = Depends(get_db), )", "description": "Handles GET requests to list orders for the current user, with optional limit.", "scope": "", "scopeKind": ""}, {"name": "get_order_by_id( order_id: str, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )", "description": "Handles GET requests to retrieve a specific order by ID, with access control based on ownership or roles.", "scope": "", "scopeKind": ""}, {"name": "update_order_status( order_id: str, body: OrderStatusUpdateIn, _: AuthUser = Depends(require_roles([\"admin\", \"agent\", \"engineer\"])), db: Database = Depends(get_db), )", "description": "Handles PATCH requests to update the status of an existing order, restricted to privileged roles.", "scope": "", "scopeKind": ""}], "calls": ["db.plans.find_one", "db.orders.insert_one", "db.orders.find_one", "db.engineers.find_one", "db.engineers.update_one", "db.orders.find_one", "db.orders.find", "db.orders.find_one_and_update"], "search-terms": ["orders", "create_order", "listOrdersForUser", "getOrderById", "updateOrderStatus", "engineer", "pincode", "order_id", "order status"], "state": 2, "file_id": 12, "knowledge_revision": 33, "git_revision": "133416b960eba02908dcd7a99c1ee182fc1486fd", "ctags": [{"_type": "tag", "name": "_pick_engineer_for_area", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/orders.py", "pattern": "/^def _pick_engineer_for_area(db: Database, pincode: str) -> Optional[dict]:$/", "language": "Python", "typeref": "typename:Optional[dict]", "kind": "function", "signature": "(db: Database, pincode: str)"}, {"_type": "tag", "name": "create_order", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/orders.py", "pattern": "/^def create_order($/", "language": "Python", "kind": "function", "signature": "( body: OrderCreateIn, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )"}, {"_type": "tag", "name": "get_order_by_id", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/orders.py", "pattern": "/^def get_order_by_id($/", "language": "Python", "kind": "function", "signature": "( order_id: str, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )"}, {"_type": "tag", "name": "list_orders_for_user", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/orders.py", "pattern": "/^def list_orders_for_user($/", "language": "Python", "kind": "function", "signature": "( user: AuthUser = Depends(get_current_user), limit: int = Query(20, ge=1, le=100), db: Database = Depends(get_db), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/orders.py", "pattern": "/^router = APIRouter(prefix=\"\\/api\\/orders\", tags=[\"Orders\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_order_status", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/orders.py", "pattern": "/^def update_order_status($/", "language": "Python", "kind": "function", "signature": "( order_id: str, body: OrderStatusUpdateIn, _: AuthUser = Depends(require_roles([\"admin\", \"agent\", \"engineer\"])), db: Database = Depends(get_db), )"}], "hash": "88ef7558e21cda3cd425eb79175b8007", "format-version": 4, "code-base-name": "backend_service", "filename": "backend_service/src/api/routers/orders.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/api\\/orders\", tags=[\"Orders\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"33": "133416b960eba02908dcd7a99c1ee182fc1486fd"}]}