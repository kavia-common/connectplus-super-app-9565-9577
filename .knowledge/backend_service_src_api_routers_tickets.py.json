{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for ticket management in a support system, including creating, listing, retrieving, updating status, assigning, and commenting on tickets. It uses FastAPI framework, integrates with MongoDB, and enforces authorization for various operations.", "external_files": ["src.core.auth", "src.core.db", "src.core.utils", "src.models.tickets"], "external_methods": ["get_current_user", "require_roles", "get_db", "now_utc", "oid", "serialize_doc"], "published": ["router"], "classes": [{"name": "TicketAssignIn", "description": "Input model for assigning a ticket to a user."}, {"name": "TicketCommentIn", "description": "Input model for adding a comment to a ticket."}, {"name": "TicketCreateIn", "description": "Input model for creating a new ticket."}, {"name": "TicketOut", "description": "Output model representing a ticket's data returned by API."}, {"name": "TicketStatusUpdateIn", "description": "Input model for updating ticket status."}], "methods": [{"name": "create_ticket( body: TicketCreateIn, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )", "description": "Creates a new support ticket for the current user.", "scope": "", "scopeKind": ""}, {"name": "list_tickets_for_user( user: AuthUser = Depends(get_current_user), limit: int = Query(20, ge=1, le=100), db: Database = Depends(get_db), )", "description": "Fetches a list of tickets associated with the current user.", "scope": "", "scopeKind": ""}, {"name": "get_ticket_by_id( ticket_id: str, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )", "description": "Retrieves a specific ticket by its ID, requires authorization.", "scope": "", "scopeKind": ""}, {"name": "update_ticket_status( ticket_id: str, body: TicketStatusUpdateIn, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )", "description": "Updates the status of a ticket, with permission checks based on user role.", "scope": "", "scopeKind": ""}, {"name": "assign_ticket( ticket_id: str, body: TicketAssignIn, _: AuthUser = Depends(require_roles([\"admin\", \"agent\", \"engineer\"])), db: Database = Depends(get_db), )", "description": "Assigns a ticket to a staff member (admin, agent, or engineer).", "scope": "", "scopeKind": ""}, {"name": "add_ticket_comment( ticket_id: str, body: TicketCommentIn, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )", "description": "Adds a comment or update to an existing ticket, owner or privileged users only.", "scope": "", "scopeKind": ""}], "calls": ["db.tickets.insert_one", "db.tickets.find_one", "db.tickets.find", "db.tickets.find_one_and_update"], "search-terms": ["tickets API", "support ticket endpoints", "FastAPI tickets router", "MongoDB ticket operations", "ticket assignment", "ticket comments", "ticket status updates"], "state": 2, "file_id": 10, "knowledge_revision": 35, "git_revision": "133416b960eba02908dcd7a99c1ee182fc1486fd", "ctags": [{"_type": "tag", "name": "add_ticket_comment", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/tickets.py", "pattern": "/^def add_ticket_comment($/", "language": "Python", "kind": "function", "signature": "( ticket_id: str, body: TicketCommentIn, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )"}, {"_type": "tag", "name": "assign_ticket", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/tickets.py", "pattern": "/^def assign_ticket($/", "language": "Python", "kind": "function", "signature": "( ticket_id: str, body: TicketAssignIn, _: AuthUser = Depends(require_roles([\"admin\", \"agent\", \"engineer\"])), db: Database = Depends(get_db), )"}, {"_type": "tag", "name": "create_ticket", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/tickets.py", "pattern": "/^def create_ticket($/", "language": "Python", "kind": "function", "signature": "( body: TicketCreateIn, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )"}, {"_type": "tag", "name": "get_ticket_by_id", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/tickets.py", "pattern": "/^def get_ticket_by_id($/", "language": "Python", "kind": "function", "signature": "( ticket_id: str, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )"}, {"_type": "tag", "name": "list_tickets_for_user", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/tickets.py", "pattern": "/^def list_tickets_for_user($/", "language": "Python", "kind": "function", "signature": "( user: AuthUser = Depends(get_current_user), limit: int = Query(20, ge=1, le=100), db: Database = Depends(get_db), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/tickets.py", "pattern": "/^router = APIRouter(prefix=\"\\/api\\/tickets\", tags=[\"Tickets\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_ticket_status", "path": "/home/kavia/workspace/code-generation/connectplus-super-app-9565-9577/backend_service/src/api/routers/tickets.py", "pattern": "/^def update_ticket_status($/", "language": "Python", "kind": "function", "signature": "( ticket_id: str, body: TicketStatusUpdateIn, user: AuthUser = Depends(get_current_user), db: Database = Depends(get_db), )"}], "hash": "ae3369732718f9bef078fe8881637415", "format-version": 4, "code-base-name": "backend_service", "filename": "backend_service/src/api/routers/tickets.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/api\\/tickets\", tags=[\"Tickets\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"35": "133416b960eba02908dcd7a99c1ee182fc1486fd"}]}